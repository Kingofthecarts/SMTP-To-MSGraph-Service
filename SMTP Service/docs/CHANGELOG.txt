================================================================================
                    SMTP TO MS GRAPH RELAY SERVICE
                              CHANGELOG
================================================================================


VERSION 1.1.0 - October 1, 2025
================================================================================

NEW FEATURES:

  • Added configurable default run mode
    Users can now set their preferred startup mode in Application Settings tab

  • Application Settings tab added to configuration GUI
    Combined run mode and queue settings in one organized location

  • RunMode setting persists in configuration file
    Choose between Console, Console+Tray, or Tray Only modes

  • Automatic mode selection on startup
    No need to remember command line arguments every time

  • Command line arguments override configured setting
    --console and --tray still work for one-time overrides


BUG FIXES:

  • Fixed critical UTF-8 BOM issue in SMTP greeting
    Was causing immediate disconnection with strict SMTP clients (Veeam, etc.)

  • Fixed encoding from UTF-8 with BOM to UTF-8 without BOM
    SMTP protocol requires ASCII-compatible encoding without byte order marks

  • Added proper CRLF line endings for SMTP protocol
    Ensures full RFC 5321 compliance


IMPROVEMENTS:

  • Enhanced SMTP logging with detailed connection tracking
    Every connection now logged with full details

  • Added millisecond timestamps to all SMTP operations
    Precise timing for debugging connection issues

  • Added connection duration tracking
    See exactly how long each connection lasted

  • Added command count per connection
    Track how many commands each client sent

  • Added timeout detection with 30 second read timeout
    Prevents hanging connections from blocking the server

  • Added data availability checking before reads
    Better diagnostics for connection issues

  • Improved error handling with specific exception types
    Separate handling for IOException, SocketException, and general exceptions

  • Added STARTTLS advertisement in EHLO response
    Clients can see server capabilities even if not fully implemented

  • Added 8BITMIME extension support
    Modern SMTP extension for 8-bit character support

  • Added STARTTLS command handler
    Returns proper error code "454 TLS not available" instead of "command not recognized"

  • Changed SMTP greeting to RFC 5321 compliant format
    Now uses "ESMTP Service ready" format for better compatibility


DOCUMENTATION:

  • Added .NET 9 Desktop Runtime requirement to all documentation
    Critical prerequisite now clearly documented

  • Updated README.md with prerequisites section
    Download link and verification instructions added

  • Updated SETUP_CHECKLIST.txt with Step 0
    Runtime installation is now the first step before everything else

  • Updated all documentation files with download links
    Consistent information across all docs

  • Created DOTNET_RUNTIME_REQUIREMENT.txt summary
    Complete documentation of the runtime requirement update

  • Updated RUN_MODE_FEATURE.txt with troubleshooting
    Runtime check is now first troubleshooting step


TECHNICAL DETAILS:

  • Changed StreamReader/Writer encoding to UTF8Encoding(false)
    Explicitly disable BOM in UTF-8 encoding

  • Set NewLine property to "\r\n" for proper SMTP line endings
    Ensures CRLF in all outgoing data

  • Socket timeouts set to 30 seconds for send and receive
    Prevents indefinite blocking on network operations

  • Added Task.WhenAny for read timeout implementation
    Gracefully handles clients that don't send data

  • Connection statistics tracked and logged
    Duration, command count, success/failure all recorded


================================================================================


VERSION 1.0.0 - September 30, 2025 - INITIAL RELEASE
================================================================================

CORE FEATURES:

  • Custom SMTP server implementation
    Built from scratch without external SMTP libraries

  • Full SMTP protocol support
    HELO, EHLO, AUTH LOGIN, AUTH PLAIN, MAIL FROM, RCPT TO, DATA, QUIT, RSET, NOOP

  • TCP listener on configurable port
    Default port 25, configurable in settings

  • Microsoft Graph API integration
    Send emails through Microsoft 365 using Graph API

  • OAuth authentication with Client Credentials flow
    Secure app-only authentication to Microsoft 365

  • Email queue system with automatic retry logic
    Failed emails automatically retried with configurable attempts

  • Configurable retry attempts and delays
    Set max retries and delay between attempts

  • Thread-safe in-memory queue
    Uses ConcurrentQueue for safe multi-threaded access


SECURITY FEATURES:

  • SMTP authentication support
    AUTH LOGIN and AUTH PLAIN methods supported

  • Encrypted configuration storage using Windows DPAPI
    All sensitive data encrypted at rest

  • Sensitive fields automatically encrypted
    Passwords, secrets, tenant info all protected

  • Per-machine encryption
    Configuration encrypted for the specific machine (not portable)

  • Base64 authentication support
    Standard SMTP authentication encoding


CONFIGURATION SYSTEM:

  • JSON-based configuration file (smtp-config.json)
    Easy to read and edit configuration format

  • SMTP settings configurable
    Port, authentication, credentials, message size limits

  • MS Graph settings configurable
    Tenant ID, Client ID, Client Secret, Sender Email

  • Queue settings configurable
    Max retry attempts, retry delay, max queue size

  • Log settings configurable
    Log level, file path, rolling interval

  • Configuration GUI with tabbed interface
    Easy-to-use Windows Forms interface

  • Test MS Graph connection from GUI
    Verify credentials before sending emails

  • Send test emails directly via Graph API
    Test the entire pipeline without SMTP


LOGGING SYSTEM:

  • Serilog structured logging framework
    Modern, high-performance logging

  • Rolling daily log files
    Automatic log rotation to prevent disk space issues

  • Console output with timestamps
    Real-time monitoring in console mode

  • Configurable log levels
    Debug, Information, Warning, Error

  • All SMTP transactions logged
    Complete audit trail of all SMTP activity

  • All MS Graph API calls logged
    Track every email sent through Graph

  • Authentication attempts tracked
    Security monitoring of login attempts

  • Detailed error logging with stack traces
    Full debugging information for troubleshooting


SYSTEM TRAY GUI:

  • Windows Forms-based configuration interface
    Native Windows application feel

  • Tabbed layout for organized settings
    SMTP Settings, MS Graph Settings, Application Settings, Test Email, Changelog

  • Context menu with quick actions
    Right-click for common operations

  • Service control
    Start, Stop, Restart directly from tray

  • Service status checking
    See if service is running

  • View logs functionality
    Quick access to log directory

  • Show file locations feature
    See where all files are stored

  • Configuration changes saved to encrypted file
    All settings persisted securely


WINDOWS SERVICE SUPPORT:

  • Runs as background Windows Service
    Starts automatically with Windows

  • Auto-start on system boot
    No manual intervention needed

  • Graceful shutdown handling
    Clean shutdown when stopping service

  • Service lifecycle management
    Proper start, stop, pause support

  • Compatible with Windows 10/11 and Windows Server
    Works on all modern Windows versions


OPERATING MODES:

  • Service Mode (default)
    Console with logs visible

  • Tray Mode
    System tray only with --tray argument

  • Console + Tray Mode
    Both console and tray with --console argument


EMAIL PROCESSING:

  • Multi-recipient support
    Handle multiple RCPT TO commands

  • Email header parsing
    Extract Subject, From, To, Cc

  • HTML email detection
    Recognize Content-Type for HTML emails

  • Raw message preservation
    Keep original message for debugging

  • Email body extraction
    Parse body from headers

  • Proper header/body separation
    Handle both CRLF and LF line endings


SMTP PROTOCOL COMPLIANCE:

  • RFC 5321 compliant implementation
    Follows official SMTP specification

  • Supported commands
    HELO, EHLO, AUTH, MAIL FROM, RCPT TO, DATA, RSET, NOOP, QUIT

  • Proper response codes
    220, 221, 235, 250, 334, 354, 454, 500, 501, 503, 530, 535

  • Multi-line EHLO responses
    Advertise server capabilities properly

  • SIZE extension support
    Advertise maximum message size

  • Proper error handling and response codes
    Correct SMTP responses for all situations


ERROR HANDLING:

  • Enhanced Azure AD error detection
    Recognize specific AADSTS error codes

  • Client secret expiration detection
    Detect AADSTS7000215 errors

  • Invalid tenant ID detection
    Detect AADSTS90002 errors

  • Invalid client ID detection
    Detect AADSTS700016 errors

  • Unauthorized client detection
    Recognize unauthorized_client errors

  • Detailed error messages with troubleshooting
    User-friendly guidance for common issues

  • Automatic retry on transient failures
    Handle temporary network issues


COMPATIBILITY:

  • Works with any SMTP client
    Standards-compliant SMTP implementation

  • Tested with multiple clients
    Telnet, PuTTY, PowerShell, Veeam

  • Compatible with enterprise applications
    Works with Veeam and other business software

  • Network printers supported
    Scan-to-email functionality works

  • IoT devices supported
    Any device with SMTP can send email

  • Legacy applications supported
    Provides SMTP relay for old software


DOCUMENTATION:

  • Complete README.md with installation instructions
    Step-by-step setup guide

  • README.txt for quick start
    Text-based quick reference

  • SETUP_CHECKLIST.txt with detailed steps
    Comprehensive setup checklist

  • PROJECT_NOTES.txt with technical details
    Developer documentation

  • PROJECT_COMPLETE.txt with summary
    Project completion notes

  • MESSAGE_FLOW.txt with architecture diagram
    Visual representation of system flow

  • Installation batch script (install-service.bat)
    Automated service installation


================================================================================


KNOWN LIMITATIONS
================================================================================

  • No STARTTLS/TLS encryption
    SMTP communication is unencrypted

  • No email attachments support
    Only text emails (Graph API supports attachments, not implemented)

  • No SMTP over SSL (port 465)
    Only standard SMTP on port 25

  • No user mapping
    All emails sent as configured sender

  • No SPF/DKIM validation
    No email authentication verification

  • No rate limiting
    No throttling of email sending

  • Queue is in-memory only
    Queue lost on restart (not persisted to disk)

  • No web-based configuration interface
    Only Windows Forms GUI available


================================================================================


UPCOMING FEATURES (Planned for Future Versions)
================================================================================

  • Full STARTTLS/TLS encryption support
    Secure SMTP communication

  • Email attachment support
    Send files with emails

  • Database-backed queue for persistence
    Survive restarts without losing queued emails

  • Web-based configuration interface
    Configure from any browser

  • Rate limiting per user/IP
    Prevent abuse and spam

  • Domain whitelisting/blacklisting
    Control which domains can send/receive

  • Multiple sender account support
    Use different senders for different emails

  • Real-time statistics dashboard
    Monitor email flow in real-time

  • Advanced monitoring and alerting
    Get notified of issues


================================================================================


For detailed technical information, see:
  • PROJECT_NOTES.txt - Implementation details
  • MESSAGE_FLOW.txt - Architecture diagram  
  • README.md - User documentation
  • SETUP_CHECKLIST.txt - Installation guide


================================================================================
                            END OF CHANGELOG
================================================================================
